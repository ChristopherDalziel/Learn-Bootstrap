<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Sign In with Auth0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.0/font/css/open-iconic-bootstrap.min.css" />
</head>
<style>
    html {
        background-image: url("https://free4kwallpapers.com/uploads/originals/2018/11/24/snowy-mountains-wallpaper.jpg");
        background-size: auto;
        background-repeat: no-repeat;
    }

    body {
        background-color: transparent;
    }

    form {
        background-color: white;
        padding: 10px;
    }

    #back {
        color: white;
    }

    #error-message,
    #missingEmail {
        display: none;
    }

    .box {
        background-color: #004265;
        padding: 20px;
    }

    .alert {
        margin-bottom: 1px;
        height: 30px;
        line-height: 30px;
        padding: 0px 15px;
    }

    .icon {
        margin-right: 10px;
    }

    .help1,
    .help2,
    .help3,
    .help4 {
        color: #fff;
        font-size: 12px;
    }

    #modalBackground {
        -webkit-filter: blur(2px);
        -moz-filter: blur(2px);
        -o-filter: blur(2px);
        -ms-filter: blur(2px);
        filter: blur(2px);
    }
</style>

<body>
    <div id="back" class="m-3">
        <span class="icon oi oi-chevron-left"></span><a href="#">Back to homepage</a>
    </div>
    <div class="container h-100 mt-5">
        <!-- Registration trouble modal -->
        <div class="modal" id="registrationMessage" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Having issues registering?</h5>
                        <button id="registrationMessageCloseBtn" type="button" class="btn-close" data-bs-dismiss="modal"
                            aria-label="Close">X</button>
                    </div>
                    <div class="modal-body">
                        Your attempt to register has failed. <span>1900 000 000</span> for help.
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-background row h-100 justify-content-center">
            <div class="col-10 col-md-8 col-lg-6">
                <!-- Registration form start -->
                <div id="registrationForm">
                    <form>
                        <h1>ABC</h1>
                        <h2>Lorem ipsum dolor</h2>
                        <p class="description">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quae, beatae?
                            Consequuntur qu</p>
                        <div id="error-message" class="alert alert-danger"></div>
                        <!-- Input fields -->
                        <div class="form-group my-4">
                            <label class="sr-only" for="accountNumber">Account number:</label>
                            <input type="text" class="form-control accountNumber" id="accountNumber"
                                placeholder="Account number..." name="accountNumber">
                            <small id="accountNumberHelpBlock" class="form-text text-muted">Check your Welcome Pack or
                                call
                                us 1800 000 000 for help
                            </small>
                        </div>
                        <div class="form-group my-4">
                            <label class="sr-only" for="email">Email:</label>
                            <input type="text" class="form-control email" id="email" placeholder="Email..."
                                name="email">
                            <small id="emailHelpBlock" class="form-text text-muted">Make sure it's your personal email -
                                you
                                will need to use it for verification to log in.
                            </small>
                            <div class="alert alert-primary" role="alert"> <span class="icon oi oi-info"></span>This
                                will be your username
                            </div>
                        </div>
                        <div class="form-group my-4">
                            <label class="sr-only" for="firstName">First Name:</label>
                            <input type="text" class="form-control firstName" id="firstName" placeholder="First name..."
                                name="firstName">
                            <small id="firstNameHelpBlock" class="form-text text-muted">This is the name that is shown
                                on
                                your Welcome Pack
                            </small>
                        </div>
                        <div class="form-group my-4">
                            <label class="sr-only" for="surname">Surname:</label>
                            <input type="text" class="form-control surname" id="surname" placeholder="Surname..."
                                name="surname">
                        </div>
                        <div class="form-group my-4">
                            <label class="sr-only" for="dateOfBirth">Password:</label>
                            <input type="text" class="form-control dateOfBirth" id="dateOfBirth"
                                placeholder="Date of birth..." name="dateOfBirth">
                            <small id="dateOfBirthHelpBlock" class="form-text text-muted">
                                DD/MM/YYYY
                            </small>
                        </div>
                        <div class="form-group my-4">
                            <label class="sr-only" for="password">Password:</label>
                            <input type="password" class="form-control password" id="password" placeholder="Password..."
                                name="password">
                        </div>
                        <div class="form-group my-4">
                            <label class="sr-only" for="password2">Confirm Password:</label>
                            <input type="password" class="form-control password" id="password2"
                                placeholder="Confirm your password..." name="password">
                        </div>
                        <div class="form-group mb-5">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="gridCheck">
                                <label class="form-check-label align-middle" for="gridCheck">
                                    I accept the
                                </label>
                                <span>
                                    <a href="#" class="align-middle">Terms and Conditions</a>
                                </span>
                                <button type="button" id="submitRegistrationBtn"
                                    class="btn btn-primary float-right">Register for
                                    access
                                </button>
                            </div>
                            <!-- End input fields -->
                    </form>
                    <!-- Registration form end -->
                </div>
            </div>

            <div id="loginForm">
                <!-- Login form start -->
                <form>
                    <h1>ABC</h1>
                    <h2>Lorem ipsum dolor</h2>
                    <p class="description">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quae, beatae?
                        Consequuntur qu</p>
                    <!-- Input fields -->
                    <div class="form-group my-4">
                        <label class="sr-only" for="loginEmail">Email:</label>
                        <input type="text" class="form-control email" id="loginEmail" placeholder="Email..."
                            name="loginEmail">
                    </div>
                    <div class="form-group my-4">
                        <label class="sr-only" for="loginPassword">Password:</label>
                        <input type="password" class="form-control password" id="loginPassword"
                            placeholder="Password..." name="loginPassword">
                    </div>
                    <div class="form-group mb-5">
                        <button type="button" id="loginSubmitBtn" class="btn btn-primary float-right">Login</button>
                    </div>
                    <div class="captcha-container form-group">

                    </div>
                    <!-- End input fields -->
                    <div class="form-group mt-4">
                        <a id="forgotPasswordBtn" href="#">Forgotten your password?</a>
                    </div>
                </form>
                <!-- Login form end -->
            </div>

            <div id="emailVerificationForm">
                <!-- Email verification form start -->
                <form>
                    <h1>ABC</h1>
                    <h2>Lorem ipsum dolor</h2>
                    <p class="description">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quae, beatae?
                        Consequuntur qu</p>
                    <!-- Input fields -->
                    <div class="form-group my-4">
                        <label class="sr-only" for="verificationCode">Confirm verification code:</label>
                        <input type="text" class="form-control" id="verificationCode"
                            placeholder="Confirm your verification code..." name="verificationCode">
                        <small id="emailVerificationHelpBlock" class="form-text text-muted">Check your email for a
                            verification code
                        </small>
                    </div>
                    <div class="form-group my-4">
                        <div class="form-check">
                            <button type="button" id="verifyEmailBtn" class="btn btn-primary float-right">Verify
                                email</button>
                        </div>
                        <!-- End input fields -->
                </form>
                <!-- Email verification form end -->
                <button type="button" id="resendVerifyEmailBtn" class="btn btn-primary float-right">Resend email
                    verifcation</button>
            </div>
        </div>



        <div id="passwordResetVerifcationForm">
            <!-- Password reset verification form start -->
            <form>
                <h1>ABC</h1>
                <h2>Lorem ipsum dolor</h2>
                <p class="description">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quae, beatae?
                    Consequuntur qu</p>
                <div id="missingEmail" class="alert alert-danger">Please enter an email address</div>
                <!-- Input fields -->
                <div class="form-group my-4">
                    <label class="sr-only" for="passwordResetVerifcationCode">Confirm verification code:</label>
                    <input type="text" class="form-control" id="passwordResetVerifcationCode"
                        placeholder="Confirm your verification code..." name="passwordResetVerifcationCode">
                    <small id="emailVerificationHelpBlock" class="form-text text-muted">Check your mobile phone for a
                        verification
                        code
                    </small>
                </div>
                <div class="form-group my-4">
                    <div class="form-check">
                        <button type="button" id="resetPasswordVerifcationBtn" class="btn btn-primary float-right">Reset
                            password</button>
                    </div>
                    <!-- End input fields -->
            </form>
            <!-- Password reset verification form end -->
        </div>
    </div>

    <div id="passwordResetForm">
        <!-- Password reset form start -->
        <form>
            <h1>ABC</h1>
            <h2>Lorem ipsum dolor</h2>
            <p class="description">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quae, beatae?
                Consequuntur qu</p>
            <!-- Input fields -->
            <div class="form-group my-4">
                <label class="sr-only" for="resetPasswordEmail">Email:</label>
                <input type="text" class="form-control" id="resetPasswordEmail"
                    placeholder="Confirm your email address.." name="resetPasswordEmail">
            </div>
            <div class="form-group my-4">
                <div class="form-check">
                    <button id="passwordResetBtn" type="submit" class="btn btn-primary float-right">Request verifcation
                        code</button>
                </div>
                <!-- End input fields -->
        </form>
        <!-- Password reset form end -->
    </div>
    </div>
    </div>

    <!-- Help block -->
    <div class="border col-10 col-md-8 col-lg-3 h-50 box">
        <div class="help1 border-bottom">
            <h4><span class="icon oi oi-person"></span>Already registered?</h4>
            <a id="loginBtn" href="#" class="btn btn-light btn-sm btn-block mb-3" role="button" aria-disabled="true">Log
                in
            </a>
        </div>
        <div class="help2 border-bottom mt-2">
            <h4><span class="icon oi oi-question-mark"></span>Need some help?</h4>
            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quasi totam vel, cum reiciendis tenetur
                quia ullam soluta. Praesentium minus explicabo ducimus mollitia dolorum, ipsam tenetur, et
                voluptatum quae, nostrum atque!
            </p>
            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Eius, rem. Incidunt molestiae
                repellendus
                et sunt iure perferendis saepe ipsam.
            </p>
        </div>
        <div class="help3 border-bottom mt-2">
            <h4 class="mt-2"><span class="icon oi oi-person"></span>You're already a ABC customer?</h4>
            <a class="btn btn-light btn-sm btn-block mb-3" tabindex="-1" role="button" aria-disabled="true">Log
                in to ABC Internet
            </a>
        </div>
        <div class="help4">
            <h4 class="mt-2"><span></span>First time here?</h4>
            <a id="signUpBtn" href="#" class="btn btn-light btn-sm btn-block" role="button"
                aria-disabled="true">Register
                for access</a>
        </div>
    </div>

    <!--[if IE 8]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/ie8/0.2.5/ie8.js"></script>
  <![endif]-->

    <!--[if lte IE 9]>
  <script src="https://cdn.auth0.com/js/polyfills/1.0/base64.min.js"></script>
  <script src="https://cdn.auth0.com/js/polyfills/1.0/es5-shim.min.js"></script>
  <![endif]-->

    <script src="https://cdn.auth0.com/js/auth0/9.14/auth0.min.js"></script>
    <script src="https://cdn.auth0.com/js/polyfills/1.0/object-assign.min.js"></script>
    <script>
        window.addEventListener('load', function () {
            $("#registrationForm").hide();
            $("#emailVerificationForm").hide();
            $("#passwordResetForm").hide();
            $("#passwordResetVerifcationForm").hide();
            var urlParams = new URLSearchParams(window.location.search)
            if (urlParams.has("login_hint") && urlParams.get("login_hint") === "notverified") {
                $("#loginForm").hide();
                $("#emailVerificationForm").show();
                console.log("not verified tag")
            }

            $("#signUpBtn").click(function () {
                $("#loginForm").hide();
                $("#passwordResetForm").hide();
                $("#passwordResetVerifcationForm").hide();
                $("#registrationForm").show();
            });

            $("#loginBtn").click(function () {
                $("#registrationForm").hide();
                $("#passwordResetForm").hide();
                $("#passwordResetVerifcationForm").hide();
                $("#loginForm").show();
            });

            $("#forgotPasswordBtn").click(function () {
                $("#loginForm").hide();
                $("#passwordResetForm").show();
            })

            var config = JSON.parse(
                decodeURIComponent(escape(window.atob('@@config@@')))
            );

            var leeway = config.internalOptions.leeway;
            if (leeway) {
                var convertedLeeway = parseInt(leeway);

                if (!isNaN(convertedLeeway)) {
                    config.internalOptions.leeway = convertedLeeway;
                }
            }

            var params = Object.assign({
                overrides: {
                    __tenant: config.auth0Tenant,
                    __token_issuer: config.authorizationServer.issuer
                },
                domain: config.auth0Domain,
                clientID: config.clientID,
                redirectUri: config.callbackURL,
                responseType: 'code'
            }, config.internalOptions);

            var webAuth = new auth0.WebAuth(params);
            var databaseConnection = 'Username-Password-Authentication';
            var captcha = webAuth.renderCaptcha(
                document.querySelector('.captcha-container')
            );

            function login(e) {
                e.preventDefault();
                var button = this;
                var username = $('#loginEmail').val();
                var password = $('#loginPassword').val();
                button.disabled = true;

                webAuth.login({
                    realm: databaseConnection,
                    username: username,
                    password: password,
                    captcha: captcha.getValue()
                }, function (err) {
                    if (err) displayError(err);
                    button.disabled = false;
                });
            }

            let attempts = 0;

            function signup() {
                var button = this;
                var email = $("#email").val();
                var password = $('#password').val();
                var firstName = $('#firstName').val();
                var surname = $('#surname').val();
                var accountNumber = $('#accountNumber').val();
                var dateOfBirth = $('#dateOfBirth').val();
                var verificationForm = $("#emailVerificationForm");
                var signupForm = $("#registrationForm");
                var maxAttempts = 2;

                button.disabled = true;
                webAuth.signup({
                    connection: databaseConnection,
                    email: email,
                    password: password,
                    captcha: captcha.getValue(),
                    given_name: firstName,
                    family_name: surname,
                    user_metadata: {
                        accountNumber: accountNumber,
                        dateOfBirth: dateOfBirth
                    }
                }, function (err) {
                    if (err) displayError(err),
                        $("#password").val(""),
                        $("#password2").val(""),
                        attempts++,
                        console.log("Attempts: ", attempts, "Max: ", maxAttempts),
                        attempts >= maxAttempts ? $("#registrationMessage").show() && $(".modal-background").attr("id", "modalBackground") : '',
                        button.disabled = false;
                    else {
                        verificationForm.show();
                        signupForm.hide();
                    }
                });
            }

            function verifyEmail() {
                var button = this;
                var email = $("#email").val();
                var verificationCode = $("#verificationCode").val();
                var verificationForm = $("#emailVerificationForm");
                var loginForm = $('#loginForm');

                if (!verificationCode) {
                    alert("Please enter the verification code sent to your email.");
                    return;
                }

                webAuth.passwordlessVerify({
                    connection: "email",
                    email: email,
                    verificationCode: verificationCode,
                }, function (err, res) {
                    if (err) {
                        displayError(err) && console.log(err);
                        return
                    }
                    console.log('Verifcation successful..')
                    verificationForm.hide()
                    loginForm.show()
                });
            }

            function resendVerificationEmail(e) {
                e.preventDefault();
                var email = $("#email").val();
                var verificationForm = $("#emailVerificationForm");
                var loginForm = $('#loginForm');

                webAuth.passwordlessStart({
                    connection: "email",
                    email: email,
                    send: "code",
                }, function (err, res) {
                    console.log('Verifcation successful.. (resend)')
                    console.log(res)
                    if (err) displayError(err);
                });
            }

            function resetPassword(e) {
                e.preventDefault();
                var email = $("#resetPasswordEmail").val();

                if (!email) {
                    alert("Please enter your email.");
                    return;
                }

                webAuth.changePassword({
                    connection: databaseConnection,
                    email: email
                }, function (err, resp) {
                    if (err) {
                        console.log(err.message);
                        $('missingEmail').css("display", "block");
                    } else {
                        console.log(resp);
                        // alert(resp);
                        $("#passwordResetForm").hide();
                        $("#passwordResetVerifcationForm").show();
                    }
                });
            }

            function displayError(err) {
                captcha.reload();
                var errorMessage = $('#error-message');
                $('#error-message').html(err.description);
                $('#error-message').css("display", "block");
            }

            function closeModal() {
                $("#registrationMessage").hide() && $(".modal-background").attr("id", "");
            }

            $("#resendVerifyEmailBtn").click(resendVerificationEmail);
            $("#registrationMessageCloseBtn").click(closeModal)
            $("#verifyEmailBtn").click(verifyEmail);
            $("#submitRegistrationBtn").click(signup);
            $("#loginSubmitBtn").click(login);
            $("#passwordResetBtn").click(resetPassword);
        });
    </script>
</body>

</html>